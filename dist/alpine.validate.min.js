(()=>{var W=function(D){let I="data-error",G=`${I}-msg`,$="error-msg",x="validate",T="required",P="input",w="checkbox",_="radio",X="group",N="form",L="fieldset",q=t=>`:not([type="${t}"])`,b=`${P}${q("search")}${q("reset")}${q("submit")},select,textarea`,k="hidden",i=(t,e)=>{let n=t instanceof HTMLElement;return e?n&&t.matches(e):n},U=(t,e)=>Array.isArray(t)&&t.includes(e),j=(t,e,n)=>t.addEventListener(e,n),p=(t,e)=>t.getAttribute(e),l=(t,e,n="")=>t.setAttribute(e,n),E=(t,e=document)=>i(t)?t:e.querySelector(`#${t}`)||e.querySelector(`[name ="${t}"]`),y=t=>t&&t.closest(N),C=t=>p(t,"name")||p(t,"id"),B=t=>{let e=p(t,"id");if(e)return e;let n=`${t.tagName.toLowerCase()}-${Math.random().toString(36).substring(2,9)}`;return l(t,"id",n),n},d=t=>{let e=E(t),n=h.get(y(e));if(!n)return!1;if(i(e,N))return Object.values(n);if(i(e,L)){let o=e.querySelectorAll(b);return Object.values(n).filter(r=>Array.from(o).some(c=>r.node===c))}if(i(e,b))return n[C(e)]};function V(t,e=document){let n=e.querySelectorAll(t);if(n.length<1)return null;if(n.length<2)return n[0];let o=document.createRange();return o.setStart(n[0],0),o.setEnd(n[n.length-1],n[n.length-1].childNodes.length),o.commonAncestorContainer}let h=new WeakMap;function v(t,e,n){var c,s;console.log("\u{1F680} ~ updateFieldData",t,e);let o=y(t),r=C(t);if(o&&r){h.has(o)||h.set(o,D.reactive({}));let a=h.get(o),u=t.matches(":disabled"),g=t.required;e={...a[r],name:r,node:t,value:u?"":t.value,required:g,disabled:u,...e};let A=e.value,R=t.checkValidity();if(!e.disabled&&R&&U([w,_],t.type)){e.required&&(R=t.checked);let f=e.array||[];if(t.type===w&&(t.checked&&!f.includes(A)&&f.push(A),t.checked||(f=f.filter(O=>O!==A))),t.type===_&&t.checked&&(f=[A]),e.array=f,e.value=f.toString(),(c=e.parentNode)==null?void 0:c.dataset.group){let O=parseInt((s=e.parentNode)==null?void 0:s.dataset.group)||1;R=f.length>=O}}e.valid=R,a[r]=e,h.set(o,a)}return n&&S(t,e.valid),e}function M(t,e,n){if((i(t,N)||i(t,L))&&d(t).forEach(r=>v(r.node)),i(t,b))return v(t,e,n)}let m={};m.data=t=>d(t),m.formData=t=>h.get(y(E(t))),m.value=(t,e)=>{t=E(t);let n=d(t);return n?Array.isArray(n)?n.reduce((o,r)=>(o[r.name]=r.value,o),{}):(e&&(n.value=e,t.value=e,v(t)),n.value):!1},m.updateData=(t,e,n)=>M(E(t),e,n),m.toggleError=(t,e)=>S(E(t),e),m.submit=t=>{let e=0;d(t.target).forEach(n=>{n=M(n.node),n.valid===!1&&(e++,e===1&&n.node.focus(),S(n.node,!1),t.preventDefault(),console.error(`${n.name} ${T}`))})},m.isComplete=t=>{let e=d(t);return Array.isArray(e)?!e.some(n=>!n.valid):e&&e.valid},D.magic(x,()=>m),D.magic("formData",t=>h.get(y(E(t)))),D.directive(x,(t,{modifiers:e})=>{let n=r=>{let c=new MutationObserver(s=>{for(let a of s){let u=a.target;if(a.type==="attributes"){let g=a.attributeName;u.matches(b)&&["disabled","required","value"].includes(g)&&(console.log("mutation",u,g),M(u)),u.matches(L)&&g==="disabled"&&M(u)}}});return c.observe(r,{attributes:!0,childList:!0,subtree:!0}),c},o=r=>{let c;if(i(r,"[type=checkbox], [type=radio]")){let g=y(r);g.querySelectorAll(`[name=${r.name}]`).length>1&&(c=V(`[name=${r.name}]`,g))}let s=[...e,r.type],a=r.required,u=r.matches(":disabled");return{mods:s,required:a,disabled:u,parentNode:c}};if(i(t,N)){let r=t;n(r),e.includes("use-browser")||l(r,"novalidate","true"),e.includes("validate-on-submit")&&r.addEventListener("submit",function(s){m.submit(s)});let c=r.querySelectorAll(b);j(r,"reset",()=>{r.reset();let s=d(r);setTimeout(()=>{s.forEach(a=>v(a.node))},50)}),c.forEach(s=>{v(s,o(s)),Q(s)}),r.addEventListener("input",s=>{let a=s.target;console.log("input",a.name),v(a),i(a,"select, input[type=checkbox], input[type=radio], input[type=range]")&&F(a)}),r.addEventListener("focusout",s=>{let a=s.target;i(a,"select, input[type=checkbox], input[type=radio], input[type=range]")||(console.log("focusout",a.name),F(a))})}});function F(t){let e=d(t);S(t,e.valid)}function S(t,e){console.log("toggleError",t,e);let n=d(t).parentNode||t,o=document.getElementById(p(t,"aria-errormessage"));l(t,"aria-invalid",!e),e?(t.setCustomValidity(""),l(o,k),n.removeAttribute(I)):(o.removeAttribute(k),t.setCustomValidity("Invalid"),l(n,I,o.textContent))}function K(t){for(;t;){if(t=t.nextElementSibling,i(t,`.${$}`))return t;if(i(t,b))return!1}return!1}function Q(t){let n=d(t).parentNode||t.closest("label")||t,o=document.createElement("span");o.className=$;let r=document.getElementById(`${$}-${p(n,"id")}`)||K(n)||o,c=B(n),s=`${$}-${c}`;p(r,"id")!==s&&l(r,"id",s),l(r,k);let a=C(t);r.innerHTML||(r.textContent=p(n,G)||`${a.replace(/[-_]/g," ")} ${T}`),l(t,"aria-errormessage",s),E(s,y(t))||n.after(r)}},H=W;document.addEventListener("alpine:init",()=>{window.Alpine.plugin(H)});})();
